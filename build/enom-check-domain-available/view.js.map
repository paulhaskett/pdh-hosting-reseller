{"version":3,"file":"enom-check-domain-available/view.js","mappings":"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","sources":["webpack://pdh-hosting-reseller/./src/enom-check-domain-available/view.js"],"sourcesContent":["/**\n * Use this file for JavaScript code that you want to run in the front-end\n * on posts/pages that contain this block.\n *\n * When this file is defined as the value of the `viewScript` property\n * in `block.json` it will be enqueued on the front end of the site.\n *\n * Example:\n *\n * ```js\n * {\n *   \"viewScript\": \"file:./view.js\"\n * }\n * ```\n *\n * If you're not making any changes to this file because your project doesn't need any\n * JavaScript running in the front-end, then you should delete this file and remove\n * the `viewScript` property from `block.json`.\n *\n * @see https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/#view-script\n */\nconsole.log(\"this ran \")\nif (typeof window.DomainWidget === 'undefined') {\n\tconsole.error('DomainWidget object not found')\n\n}\nconsole.log(window.DomainWidget.token)\nconsole.log(DomainWidget.restUrl)\nconsole.log(DomainWidget.name)\n\n/* eslint-disable no-console */\ndocument.addEventListener('DOMContentLoaded', () => {\n\tdocument.querySelectorAll('.domain-search-form').forEach(form => {\n\t\tconst resultDiv = form.querySelector('.domain-search-result') || (() => {\n\t\t\tconst div = document.createElement('div')\n\t\t\tdiv.className = 'domain-search-result'\n\t\t\tform.appendChild(div)\n\t\t\treturn div\n\t\t})()\n\n\t\tform.addEventListener('submit', async (e) => {\n\t\t\te.preventDefault()\n\t\t\tconst domainInput = form.querySelector('input[name=\"domain\"]')\n\t\t\tconst tldSelect = form.querySelector('select[name=\"tld\"]')\n\t\t\tconst domain = domainInput.value.trim()\n\t\t\tconst tld = tldSelect.value\n\t\t\tconst domain_name = document.getElementById('domain_name')\n\n\t\t\tif (!domain) return resultDiv.textContent = \"Please enter a valid domain\"\n\n\t\t\tresultDiv.textContent = 'Checking…'\n\n\t\t\ttry {\n\t\t\t\tconst response = await fetch('/wp-json/pdh-enom/v2/check-domain', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t'X-WP-Nonce': DomainWidget.token\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({ domain, tld })\n\t\t\t\t})\n\t\t\t\tconst data = await response.json()\n\t\t\t\tconst result = data['Domains']\n\t\t\t\tconsole.log('result', result)\n\t\t\t\tif (result.Domain.RRPText === 'Domain not available') {\n\t\t\t\t\tavailable = false\n\t\t\t\t} else {\n\t\t\t\t\tavailable = true\n\t\t\t\t}\n\t\t\t\tconsole.log('RRPText', result.Domain.RRPText)\n\t\t\t\tconsole.log(available)\n\t\t\t\tconst prices = result.Domain.Prices\n\t\t\t\tconst regPrice = prices.Registration\n\t\t\t\tconst productForm = form.closest('form.cart') || form\n\n\n\n\t\t\t\tif (available) {\n\t\t\t\t\tresultDiv.textContent = `✅ Domain ${result.Domain.Name} is available! £${prices.Registration} to register!`\n\n\n\n\t\t\t\t\t// add the domain name to product field \n\t\t\t\t\t// if on the single product page and the domain_name field is accessible \n\t\t\t\t\t// else display button to forward to the single product page and fill domain_name field\n\n\t\t\t\t\tif (domain_name) {\n\n\t\t\t\t\t\tdomain_name.value = result.Domain.Name\n\n\t\t\t\t\t\t// update product price on single product page\n\t\t\t\t\t\tconsole.log('hello')\n\t\t\t\t\t\tupdateDomainPriceOnPage(regPrice)\n\t\t\t\t\t\t// update product price in cart\n\t\t\t\t\t\tensureHiddenPriceInput(productForm, regPrice)\n\t\t\t\t\t\taddDomainToCart(domain, tld, regPrice)\n\n\n\n\n\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst button = document.createElement('a')\n\t\t\t\t\t\tbutton.textContent = 'Configure Domain Registration'\n\t\t\t\t\t\tbutton.href = '/product/register-domain/?domain_name=' + encodeURIComponent(result.Domain.Name) + '&domain_tld=' + encodeURIComponent(prices.Registration) + '&domain_registration_price=' + encodeURIComponent(prices.Registration)\n\t\t\t\t\t\tbutton.className = 'wp-element-button configure-domain-btn'\n\t\t\t\t\t\tconst buttonContainer = document.createElement('div')\n\t\t\t\t\t\tbuttonContainer.appendChild(button)\n\t\t\t\t\t\tresultDiv.appendChild(buttonContainer)\n\t\t\t\t\t}\n\n\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif (domain_name) {\n\t\t\t\t\t\tdomain_name.value = ''\n\t\t\t\t\t}\n\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log('Fetching name suggestions for', result.Domain.Name)\n\t\t\t\t\t\tconst namesuggestions = await fetch('/wp-json/pdh-enom/v2/get-name-suggestions', {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t\t'X-WP-Nonce': DomainWidget.token\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbody: JSON.stringify({ searchterm: result.Domain.Name })\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tconst data = await namesuggestions.json()\n\t\t\t\t\t\tconsole.log('data response', data)\n\t\t\t\t\t\tconst suggestions = data['DomainSuggestions'] || []\n\t\t\t\t\t\tconsole.log('suggestions ', suggestions)\n\t\t\t\t\t\tconsole.log('suggestions length', suggestions['Domain'].length)\n\t\t\t\t\t\t// create resultDiv and display suggested names\n\t\t\t\t\t\tresultDiv.textContent = `❌ Domain ${result.Domain.Name} is taken.`\n\t\t\t\t\t\tconst suggestionsDiv = document.createElement('div')\n\t\t\t\t\t\tsuggestionsDiv.className = 'domain-suggestions'\n\n\t\t\t\t\t\tif (suggestions['Domain'].length > 0) {\n\t\t\t\t\t\t\tsuggestionsDiv.innerHTML = '<div class =\"domain-suggestions\"><strong>Suggestions:</strong><ul class=\"domain-name-suggestions\">' +\n\t\t\t\t\t\t\t\tsuggestions['Domain'].map(s => `<li>${s}</li>`).join('') +\n\t\t\t\t\t\t\t\t'</ul></div>'\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsuggestionsDiv.textContent = 'No alternative suggestions found.'\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresultDiv.appendChild(suggestionsDiv)\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tconsole.error('Error fetching name suggestions', err)\n\t\t\t\t\t}\n\n\n\t\t\t\t}\n\n\n\t\t\t} catch (err) {\n\t\t\t\tresultDiv.textContent = 'Error checking domain.'\n\t\t\t}\n\t\t})\n\t})\n})\n\n// call this when you have newPrice (a number or numeric string)\nfunction updateDomainPriceOnPage(newPrice) {\n\tif (typeof newPrice === 'string') newPrice = parseFloat(newPrice.replace(/[^0-9\\.\\-]+/g, ''))\n\tif (isNaN(newPrice)) return\n\n\t// Format to 2 decimal places (change as needed)\n\tconst formatted = newPrice.toFixed(2)\n\tconsole.log('newPrice', formatted)\n\t// Update all WooCommerce price elements on the page\n\tdocument.querySelectorAll('.woocommerce-Price-amount.amount').forEach(el => {\n\t\t// Keep currency span if present, otherwise insert currency symbol manually\n\t\tconst currencySpan = el.querySelector('.woocommerce-Price-currencySymbol')\n\t\tif (currencySpan) {\n\t\t\t// Replace rest of content inside <bdi> or el\n\t\t\tconst currencyHtml = currencySpan.outerHTML\n\t\t\tel.innerHTML = `<bdi>${currencyHtml}${formatted}</bdi>`\n\t\t} else {\n\t\t\t// fallback: inject bdi with £ by default (or use DomainWidget.currency if available)\n\t\t\tconst symbol = (window.DomainWidget && DomainWidget.currency) ? DomainWidget.currency : '£'\n\t\t\tel.innerHTML = `<bdi><span class=\"woocommerce-Price-currencySymbol\">${symbol}</span>${formatted}</bdi>`\n\t\t}\n\t})\n\n\t// TODO Make sure a hidden input named domain_registration_price exists inside the product form\n\n\tlet cartForm = document.querySelector('form.cart')\n\n\t// If not on a product page, try to find domain-fields form \n\tif (!cartForm) cartForm = document.querySelector('.domain-search-form') || document.querySelector('form')\n\n\tif (cartForm) {\n\t\tlet hidden = cartForm.querySelector('input[name=\"domain_registration_price\"]')\n\t\tif (!hidden) {\n\t\t\thidden = document.createElement('input')\n\t\t\thidden.type = 'hidden'\n\t\t\thidden.name = 'domain_registration_price'\n\t\t\tcartForm.appendChild(hidden)\n\t\t}\n\t\thidden.value = formatted\n\n\t\t// Also set domain_name hidden input\n\t\tlet nameHidden = cartForm.querySelector('input[name=\"domain_name\"]')\n\t\tif (!nameHidden) {\n\t\t\tnameHidden = document.createElement('input')\n\t\t\tnameHidden.type = 'hidden'\n\t\t\tnameHidden.name = 'domain_name'\n\t\t\tcartForm.appendChild(nameHidden)\n\t\t}\n\t\t// and set the tld hidden input\n\t\tlet tldHidden = cartForm.querySelector('input[name=\"domain_tld\"]')\n\t\tif (!tldHidden) {\n\t\t\ttldHidden = document.createElement('input')\n\t\t\ttldHidden.type = 'hidden'\n\t\t\ttldHidden.name = 'domain_tld'\n\t\t\tcartForm.appendChild(tldHidden)\n\t\t}\n\t\t// If you have the domain name on the page, set it; otherwise set blank\n\t\tconst visibleDomainInput = document.querySelector('input[name=\"domain\"]') || document.getElementById('domain_name')\n\t\tnameHidden.value = visibleDomainInput ? visibleDomainInput.value.trim() : ''\n\t}\n}\n// add price to cart form\nfunction ensureHiddenPriceInput(productForm, priceValue) {\n\tlet input = productForm.querySelector('input[name=\"domain_registration_price\"]')\n\tif (!input) {\n\t\tinput = document.createElement('input')\n\t\tinput.type = 'hidden'\n\t\tinput.name = 'domain_registration_price'\n\t\tproductForm.appendChild(input)\n\t}\n\tinput.value = String(priceValue)\n\t// add flag so server knows this cart item is a domain registration\n\tlet flag = productForm.querySelector('input[name=\"is_domain_registration\"]')\n\tif (!flag) {\n\t\tflag = document.createElement('input')\n\t\tflag.type = 'hidden'\n\t\tflag.name = 'is_domain_registration'\n\t\tproductForm.appendChild(flag)\n\t}\n\tflag.value = '1'\n}\n\nasync function addDomainToCart(domainName, domainTld, price) {\n\ttry {\n\t\tconst response = await fetch('/wp-json/pdh-enom/v2/add-domain-to-cart', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'X-WP-Nonce': DomainWidget.token\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\n\t\t\t\tdomain_name: domainName,\n\t\t\t\tdomain_tld: domainTld,\n\t\t\t\tdomain_registration_price: price\n\t\t\t})\n\t\t})\n\t\tconst data = await response.json()\n\t\tif (data.success) {\n\t\t\tconsole.log('Domain added to cart')\n\t\t\t// Optionally update mini-cart or redirect\n\t\t} else {\n\t\t\tconsole.error('Error adding domain to cart', data)\n\t\t}\n\t} catch (err) {\n\t\tconsole.error('Network error', err)\n\t}\n}\n\n/* eslint-enable no-console */\n"],"names":["console","log","window","DomainWidget","error","token","restUrl","name","document","addEventListener","querySelectorAll","forEach","form","resultDiv","querySelector","div","createElement","className","appendChild","e","preventDefault","domainInput","tldSelect","domain","value","trim","tld","domain_name","getElementById","textContent","response","fetch","method","headers","body","JSON","stringify","data","json","result","Domain","RRPText","available","prices","Prices","regPrice","Registration","productForm","closest","Name","updateDomainPriceOnPage","ensureHiddenPriceInput","addDomainToCart","button","href","encodeURIComponent","buttonContainer","namesuggestions","searchterm","suggestions","length","suggestionsDiv","innerHTML","map","s","join","err","newPrice","parseFloat","replace","isNaN","formatted","toFixed","el","currencySpan","currencyHtml","outerHTML","symbol","currency","cartForm","hidden","type","nameHidden","tldHidden","visibleDomainInput","priceValue","input","String","flag","domainName","domainTld","price","domain_tld","domain_registration_price","success"],"sourceRoot":""}